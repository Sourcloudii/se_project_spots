!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__save-btn",inactiveButtonClass:"modal__save-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},t=(e,t,r)=>{const n=e.querySelector(`#${t.id}-error`);n&&(t.classList.remove(r.inputErrorClass),n.textContent="")},r=e=>{e.disabled=!0},n=(e,t)=>{(e=>e.some((e=>!e.validity.valid)))(e)?r(t):t.disabled=!1},o=(r,n)=>{n.forEach((n=>{t(r,n,e)}))};function a(e,t,r="Saving...",n="Save"){t?(e.textContent=r,e.disabled=!0):"Delete"===n?(e.textContent=n,e.disabled=!1):e.textContent=n}const s=document.querySelectorAll(".modal__close-btn"),c=document.querySelectorAll(".modal"),l=document.querySelector("#avatar-modal"),i=l.querySelector(".modal__form"),d=document.querySelector(".profile__avatar-btn"),u=document.querySelector(".profile__avatar"),m=l.querySelector("#profile-avatar-input"),h=document.querySelector("#card-template").content.querySelector(".card"),_=document.querySelector(".cards__list"),f=document.querySelector(".profile__edit-btn"),p=document.querySelector(".profile__name"),v=document.querySelector(".profile__description"),y=document.querySelector("#edit-modal"),S=y.querySelector(".modal__form"),b=y.querySelector("#profile-name-input"),k=y.querySelector("#profile-description-input"),q=document.querySelector("#delete-modal"),E=q.querySelector(".modal__form"),L=q.querySelector(".modal__cancel-btn");let C,g;const U=document.querySelector("#add-card-modal"),x=U.querySelector(".modal__form"),A=document.querySelector(".profile__post-btn"),$=U.querySelector("#card-link-input"),D=U.querySelector("#card-caption-input"),I=document.querySelector("#preview-modal"),R=I.querySelector(".modal__image"),T=I.querySelector(".modal__caption"),w=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}editUserAvatar({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}postNewCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}handleLikeStatus(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"403e13a2-b5e1-4f12-b34b-030d308366cc","Content-Type":"application/json"}});function N(e){const t=h.cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image"),o=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return r.textContent=e.name,n.src=e.link,n.alt=e.alt||e.name,e.isLiked&&o.classList.add("card__like-btn_liked"),o.addEventListener("click",(t=>function(e,t){t.target.classList.contains("card__like-btn_liked")?w.handleLikeStatus(e,!0).then((()=>{t.target.classList.remove("card__like-btn_liked")})).catch(console.error):w.handleLikeStatus(e,!1).then((()=>{t.target.classList.add("card__like-btn_liked")})).catch(console.error)}(e._id,t))),a.addEventListener("click",(()=>function(e,t){C=e,g=t,P(q)}(t,e._id))),L.addEventListener("click",(()=>{O(q)})),n.addEventListener("click",(()=>{P(I),R.src=e.link,R.alt=e.alt,T.textContent=e.name})),t}function P(e){e.classList.add("modal_opened"),document.addEventListener("keydown",j)}function O(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",j)}function j(e){"Escape"===e.key&&O(document.querySelector(".modal_opened"))}var B;w.getAppInfo().then((([e,t])=>{e.forEach((e=>{const t=N(e);_.append(t)})),u.src=t.avatar,p.textContent=t.name,v.textContent=t.about})).catch((e=>{console.error(e)})),s.forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>O(t)))})),c.forEach((e=>{e.addEventListener("click",(t=>{t.target===e&&O(e)}))})),d.addEventListener("click",(()=>{P(l)})),i.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;a(t,!0),w.editUserAvatar({avatar:m.value}).then((e=>{u.src=e.avatar,O(l),i.reset()})).catch(console.error).finally((()=>{a(t,!1)}))})),f.addEventListener("click",(()=>{b.value=p.textContent,k.value=v.textContent,o(S,[b,k]),P(y)})),S.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;a(t,!0),w.editUserInfo({name:b.value,about:k.value}).then((e=>{p.textContent=e.name,v.textContent=e.about,O(y)})).catch(console.error).finally((()=>{a(t,!1)}))})),E.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;a(t,!0,"Deleting..."),C&&w.deleteCard(g).then((()=>{C.remove(),C=null,O(q)})).catch(console.error).finally((()=>{a(t,!1,"Deleting...","Delete")}))})),A.addEventListener("click",(()=>{P(U)})),x.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;a(t,!0),w.postNewCard({name:D.value,link:$.value}).then((e=>{const t=N(e);_.prepend(t),O(U),x.reset()})).catch(console.error).finally((()=>{a(t,!1)}))})),B=e,Array.from(document.querySelectorAll(B.formSelector)).filter((e=>"delete-form"!==e.id)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault(),r(e.submitter)})),((e,r)=>{const a=Array.from(e.querySelectorAll(r.inputSelector)),s=e.querySelector(r.submitButtonSelector);o(e,a),n(a,s),a.forEach((o=>{o.addEventListener("input",(function(){((e,r,n)=>{r.validity.valid?t(e,r,n):((e,t,r,n)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),o.textContent=r})(e,r,r.validationMessage,n)})(e,o,r),n(a,s)}))}))})(e,B)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBVWlHLFFBQVF0QyxHQUNsQm9CLEVBQVdsRSxHQUNYQyxFQUFTaUYsV0FFVnZCLE1BQU1DLFFBQVFDLE9BQ2RzQixTQUFRLEtBQ1BoSCxFQUFXNEcsR0FBVyxLQUU1QixJRmpIaUMvSCxFRXNNaEJWLEVGck1FK0ksTUFBTUMsS0FBSzdHLFNBQVNDLGlCQUFpQjFCLEVBQU9ULGVBQWVnSixRQUN6RUMsR0FBcUIsZ0JBQVpBLEVBQUtySSxLQUdSYyxTQUFTbkIsSUFDaEJBLEVBQVl5RyxpQkFBaUIsVUFBV0MsSUFDdENBLEVBQUlzQixpQkFDSnZILEVBQWVpRyxFQUFJd0IsY0F2QkNTLEVBQUMzSSxFQUFhRSxLQUN0QyxNQUFNVyxFQUFZMEgsTUFBTUMsS0FBS3hJLEVBQVk0QixpQkFBaUIxQixFQUFPUixnQkFDM0RnQixFQUFnQlYsRUFBWUksY0FBY0YsRUFBT1Asc0JBRXZEdUIsRUFBZ0JsQixFQUFhYSxHQUM3QkQsRUFBa0JDLEVBQVdILEdBRTdCRyxFQUFVTSxTQUFTbEIsSUFDakJBLEVBQWF3RyxpQkFBaUIsU0FBUyxXQXhDaEJtQyxFQUFDNUksRUFBYUMsRUFBY0MsS0FDaERELEVBQWFjLFNBQVNDLE1BR3pCakIsRUFBZUMsRUFBYUMsRUFBY0MsR0F0QnZCMkksRUFBQzdJLEVBQWFDLEVBQWM2SSxFQUFjNUksS0FDL0QsTUFBTUMsRUFBZUgsRUFBWUksY0FBYyxJQUFJSCxFQUFhSSxZQUVoRUosRUFBYUssVUFBVWtHLElBQUl0RyxFQUFPTCxpQkFDbENNLEVBQWFLLFlBQWNzSSxHQWdCekJELENBQWU3SSxFQUFhQyxFQUFjQSxFQUFhOEksa0JBQW1CN0ksSUF1Q3hFMEksQ0FBbUI1SSxFQUFhQyxFQUFjQyxHQUM5Q1UsRUFBa0JDLEVBQVdILEVBQy9CLFFBY0FpSSxDQUFrQjNJLEVBQWFFLEsiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc2F2ZS1idG5cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc2F2ZS1idG5fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yXCIsXG59O1xuXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UsIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG5cbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbn07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG5cbiAgaWYgKGVycm9yRWxlbWVudCkge1xuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuO1xuICB9XG59O1xuXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IGRpc2FibGVkQnV0dG9uID0gKGJ1dHRvbkVsZW1lbnQpID0+IHtcbiAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG59O1xuXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVkQnV0dG9uKGJ1dHRvbkVsZW1lbnQpO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWxlbWVudCwgaW5wdXRMaXN0KSA9PiB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dCwgc2V0dGluZ3MpO1xuICB9KTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgcmVzZXRWYWxpZGF0aW9uKGZvcm1FbGVtZW50LCBpbnB1dExpc3QpO1xuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQpO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3RvcikpLmZpbHRlcihcbiAgICAoZm9ybSkgPT4gZm9ybS5pZCAhPT0gXCJkZWxldGUtZm9ybVwiXG4gICk7XG5cbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcbiAgICBmb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZGlzYWJsZWRCdXR0b24oZXZ0LnN1Ym1pdHRlcik7XG4gICAgfSk7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIGNvbmZpZyk7XG4gIH0pO1xufTsiLCJleHBvcnQgZnVuY3Rpb24gc2V0QnRuVGV4dChidG4sIGlzTG9hZGluZywgbG9hZGluZ1R4VCA9IFwiU2F2aW5nLi4uXCIsIGRlZmF1bHRUeHQgPSBcIlNhdmVcIikge1xuICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgYnRuLnRleHRDb250ZW50ID0gbG9hZGluZ1R4VDtcbiAgICBidG4uZGlzYWJsZWQgPSB0cnVlO1xuICB9IGVsc2UgaWYgKGRlZmF1bHRUeHQgPT09IFwiRGVsZXRlXCIpIHtcbiAgICBidG4udGV4dENvbnRlbnQgPSBkZWZhdWx0VHh0O1xuICAgIGJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xuICB9IGVsc2Uge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGRlZmF1bHRUeHQ7XG4gIH1cbn1cbiIsImltcG9ydCB7IHJlc2V0VmFsaWRhdGlvbiwgZW5hYmxlVmFsaWRhdGlvbiwgc2V0dGluZ3MgfSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgeyBzZXRCdG5UZXh0IH0gZnJvbSBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcblxuLy9Vbml2ZXJzYWwgdmFyaWFibGVzXG5jb25zdCBjbG9zZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IG1vZGFscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIik7XG5cbi8vRWRpdCBQcm9maWxlIEF2YXRhclxuY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgcHJvZmlsZUF2YXRhckVkaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idG5cIik7XG5jb25zdCBwcm9maWxlQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5jb25zdCBhdmF0YXJJbnB1dCA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1hdmF0YXItaW5wdXRcIik7XG5cbi8vQ2FyZHMgVGVtcGxhdGVcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKTtcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbi8vRWRpdCBQcm9maWxlIE1vZGFsXG5jb25zdCBwcm9maWxlRWRpdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG5cIik7XG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5cbmNvbnN0IGVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1tb2RhbFwiKTtcbmNvbnN0IGVkaXRGb3JtRWwgPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGVkaXRNb2RhbE5hbWVJbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcbmNvbnN0IGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQgPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCIpO1xuXG4vL0RlbGV0ZSBDYXJkIE1vZGFsXG5jb25zdCBkZWxldGVDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZUZvcm1FbCA9IGRlbGV0ZUNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgY2FyZERlbGV0ZUNhbmNlbEJ0biA9IGRlbGV0ZUNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYW5jZWwtYnRuXCIpO1xubGV0IGN1cnJlbnRDYXJkLCBjdXJyZW50Q2FyZElkO1xuXG4vL1Bvc3QgQ2FyZCBNb2RhbFxuY29uc3QgY2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1tb2RhbFwiKTtcbmNvbnN0IGNhcmRGb3JtID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBjYXJkUG9zdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fcG9zdC1idG5cIik7XG5jb25zdCBjYXJkbGlua0lucHV0ID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1saW5rLWlucHV0XCIpO1xuY29uc3QgY2FyZENhcHRpb25JbnB1dCA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtY2FwdGlvbi1pbnB1dFwiKTtcblxuLy9QcmV2aWV3IE1vZGFsXG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XG5jb25zdCBwcmV2aWV3SW1hZ2VFbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbmNvbnN0IHByZXZpZXdDYXB0aW9uRWwgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiNDAzZTEzYTItYjVlMS00ZjEyLWIzNGItMDMwZDMwODM2NmNjXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKFtjYXJkcywgaW5mb10pID0+IHtcbiAgICBjYXJkcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICBjb25zdCBjYXJkRWwgPSBnZXRDYXJkRWwoaXRlbSk7XG4gICAgICBjYXJkc0xpc3QuYXBwZW5kKGNhcmRFbCk7XG4gICAgfSk7XG4gICAgcHJvZmlsZUF2YXRhci5zcmMgPSBpbmZvLmF2YXRhcjtcbiAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IGluZm8ubmFtZTtcbiAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBpbmZvLmFib3V0O1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgfSk7XG5cbmZ1bmN0aW9uIGdldENhcmRFbChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbCA9IGNhcmRUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgY29uc3QgY2FyZE5hbWVFbCA9IGNhcmRFbC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICBjb25zdCBjYXJkTGlrZUVsID0gY2FyZEVsLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idG5cIik7XG4gIGNvbnN0IGNhcmRUcmFzaEJ0biA9IGNhcmRFbC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idG5cIik7XG5cbiAgY2FyZE5hbWVFbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgY2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLmFsdCB8fCBkYXRhLm5hbWU7XG5cbiAgaWYgKGRhdGEuaXNMaWtlZCkge1xuICAgIGNhcmRMaWtlRWwuY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnRuX2xpa2VkXCIpO1xuICB9XG5cbiAgY2FyZExpa2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4gaGFuZGxlTGlrZWQoZGF0YS5faWQsIGV2dCkpO1xuXG4gIGNhcmRUcmFzaEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWwsIGRhdGEuX2lkKSk7XG5cbiAgY2FyZERlbGV0ZUNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNsb3NlTW9kYWwoZGVsZXRlQ2FyZE1vZGFsKTtcbiAgfSk7XG5cbiAgY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgICBwcmV2aWV3SW1hZ2VFbC5zcmMgPSBkYXRhLmxpbms7XG4gICAgcHJldmlld0ltYWdlRWwuYWx0ID0gZGF0YS5hbHQ7XG4gICAgcHJldmlld0NhcHRpb25FbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbDtcbn1cblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZSk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjYXBlKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRXNjYXBlKGV2dCkge1xuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgIGNvbnN0IG9wZW5lZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9vcGVuZWRcIik7XG4gICAgY2xvc2VNb2RhbChvcGVuZWRNb2RhbCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XG5cbiAgc2V0QnRuVGV4dChzdWJtaXRCdG4sIHRydWUpO1xuXG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgbmFtZTogZWRpdE1vZGFsTmFtZUlucHV0LnZhbHVlLFxuICAgICAgYWJvdXQ6IGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xuICAgICAgY2xvc2VNb2RhbChlZGl0TW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnRuVGV4dChzdWJtaXRCdG4sIGZhbHNlKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcblxuICBzZXRCdG5UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSk7XG5cbiAgYXBpXG4gICAgLmVkaXRVc2VyQXZhdGFyKHsgYXZhdGFyOiBhdmF0YXJJbnB1dC52YWx1ZSB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlQXZhdGFyLnNyYyA9IGRhdGEuYXZhdGFyO1xuICAgICAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XG4gICAgICBhdmF0YXJGb3JtLnJlc2V0KCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdG5UZXh0KHN1Ym1pdEJ0biwgZmFsc2UpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVDYXJkRm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcblxuICBzZXRCdG5UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSk7XG5cbiAgYXBpXG4gICAgLnBvc3ROZXdDYXJkKHtcbiAgICAgIG5hbWU6IGNhcmRDYXB0aW9uSW5wdXQudmFsdWUsXG4gICAgICBsaW5rOiBjYXJkbGlua0lucHV0LnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGNvbnN0IGNhcmRFbCA9IGdldENhcmRFbChkYXRhKTtcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbCk7XG4gICAgICBjbG9zZU1vZGFsKGNhcmRNb2RhbCk7XG4gICAgICBjYXJkRm9ybS5yZXNldCgpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnRuVGV4dChzdWJtaXRCdG4sIGZhbHNlKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlTGlrZWQoaWQsIGV2dCkge1xuICBjb25zdCBpc0xpa2VkID0gZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcbiAgaWYgKCFpc0xpa2VkKSB7XG4gICAgYXBpXG4gICAgICAuaGFuZGxlTGlrZVN0YXR1cyhpZCwgZmFsc2UpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnRuX2xpa2VkXCIpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgfSBlbHNlXG4gICAgYXBpXG4gICAgICAuaGFuZGxlTGlrZVN0YXR1cyhpZCwgdHJ1ZSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbCwgaWQpIHtcbiAgY3VycmVudENhcmQgPSBjYXJkRWw7XG4gIGN1cnJlbnRDYXJkSWQgPSBpZDtcbiAgb3Blbk1vZGFsKGRlbGV0ZUNhcmRNb2RhbCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XG4gIHNldEJ0blRleHQoc3VibWl0QnRuLCB0cnVlLCBcIkRlbGV0aW5nLi4uXCIpO1xuXG4gIGlmIChjdXJyZW50Q2FyZCkge1xuICAgIGFwaVxuICAgICAgLmRlbGV0ZUNhcmQoY3VycmVudENhcmRJZClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgY3VycmVudENhcmQucmVtb3ZlKCk7XG4gICAgICAgIGN1cnJlbnRDYXJkID0gbnVsbDtcbiAgICAgICAgY2xvc2VNb2RhbChkZWxldGVDYXJkTW9kYWwpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBzZXRCdG5UZXh0KHN1Ym1pdEJ0biwgZmFsc2UsIFwiRGVsZXRpbmcuLi5cIiwgXCJEZWxldGVcIik7XG4gICAgICB9KTtcbiAgfVxufVxuXG4vL0Nsb3NlIG1vZGFsc1xuY2xvc2VCdG4uZm9yRWFjaCgoYnV0dG9uKSA9PiB7XG4gIGNvbnN0IG1vZGFsID0gYnV0dG9uLmNsb3Nlc3QoXCIubW9kYWxcIik7XG5cbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKG1vZGFsKSk7XG59KTtcblxubW9kYWxzLmZvckVhY2goKG1vZGFsKSA9PiB7XG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dC50YXJnZXQgPT09IG1vZGFsKSB7XG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbi8vRWRpdCBQcm9maWxlIEF2YXRhclxucHJvZmlsZUF2YXRhckVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcbn0pO1xuYXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQpO1xuXG4vL0VkaXQgUHJvZmlsZVxucHJvZmlsZUVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgZWRpdE1vZGFsTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XG4gIGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihlZGl0Rm9ybUVsLCBbZWRpdE1vZGFsTmFtZUlucHV0LCBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0XSk7XG4gIG9wZW5Nb2RhbChlZGl0TW9kYWwpO1xufSk7XG5lZGl0Rm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xuXG4vL0RlbGV0ZSBDYXJkXG5kZWxldGVGb3JtRWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVEZWxldGVTdWJtaXQpO1xuXG4vL05ldyBQb3N0XG5jYXJkUG9zdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwoY2FyZE1vZGFsKTtcbn0pO1xuY2FyZEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVDYXJkRm9ybVN1Ym1pdCk7XG5cbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xuIiwiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZWRpdFVzZXJBdmF0YXIoeyBhdmF0YXIgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBkZWxldGVDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBwb3N0TmV3Q2FyZCh7IG5hbWUsIGxpbmsgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBsaW5rLFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGhhbmRsZUxpa2VTdGF0dXMoY2FyZElkLCBpc0xpa2VkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG4gIC8vIG90aGVyIG1ldGhvZHMgZm9yIHdvcmtpbmcgd2l0aCB0aGUgQVBJXG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNvbmZpZyIsImVycm9yRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRleHRDb250ZW50IiwiZGlzYWJsZWRCdXR0b24iLCJidXR0b25FbGVtZW50IiwiZGlzYWJsZWQiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwicmVzZXRWYWxpZGF0aW9uIiwiZm9yRWFjaCIsImlucHV0Iiwic2V0QnRuVGV4dCIsImJ0biIsImlzTG9hZGluZyIsImxvYWRpbmdUeFQiLCJkZWZhdWx0VHh0IiwiY2xvc2VCdG4iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJtb2RhbHMiLCJhdmF0YXJNb2RhbCIsImF2YXRhckZvcm0iLCJwcm9maWxlQXZhdGFyRWRpdEJ0biIsInByb2ZpbGVBdmF0YXIiLCJhdmF0YXJJbnB1dCIsImNhcmRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjYXJkc0xpc3QiLCJwcm9maWxlRWRpdEJ0biIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2NyaXB0aW9uIiwiZWRpdE1vZGFsIiwiZWRpdEZvcm1FbCIsImVkaXRNb2RhbE5hbWVJbnB1dCIsImVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQiLCJkZWxldGVDYXJkTW9kYWwiLCJkZWxldGVGb3JtRWwiLCJjYXJkRGVsZXRlQ2FuY2VsQnRuIiwiY3VycmVudENhcmQiLCJjdXJyZW50Q2FyZElkIiwiY2FyZE1vZGFsIiwiY2FyZEZvcm0iLCJjYXJkUG9zdEJ0biIsImNhcmRsaW5rSW5wdXQiLCJjYXJkQ2FwdGlvbklucHV0IiwicHJldmlld01vZGFsIiwicHJldmlld0ltYWdlRWwiLCJwcmV2aWV3Q2FwdGlvbkVsIiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0QXBwSW5mbyIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJ0aGVuIiwiZWRpdFVzZXJJbmZvIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0VXNlckF2YXRhciIsImF2YXRhciIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJwb3N0TmV3Q2FyZCIsImxpbmsiLCJoYW5kbGVMaWtlU3RhdHVzIiwiaXNMaWtlZCIsImF1dGhvcml6YXRpb24iLCJnZXRDYXJkRWwiLCJkYXRhIiwiY2FyZEVsIiwiY2xvbmVOb2RlIiwiY2FyZE5hbWVFbCIsImNhcmRJbWFnZUVsIiwiY2FyZExpa2VFbCIsImNhcmRUcmFzaEJ0biIsInNyYyIsImFsdCIsImFkZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldnQiLCJ0YXJnZXQiLCJjb250YWlucyIsImNhdGNoIiwiY29uc29sZSIsImVycm9yIiwiaGFuZGxlTGlrZWQiLCJfaWQiLCJvcGVuTW9kYWwiLCJoYW5kbGVEZWxldGVDYXJkIiwiY2xvc2VNb2RhbCIsIm1vZGFsIiwiaGFuZGxlRXNjYXBlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsImNhcmRzIiwiaW5mbyIsIml0ZW0iLCJhcHBlbmQiLCJlcnIiLCJidXR0b24iLCJjbG9zZXN0IiwicHJldmVudERlZmF1bHQiLCJzdWJtaXRCdG4iLCJzdWJtaXR0ZXIiLCJ2YWx1ZSIsInJlc2V0IiwiZmluYWxseSIsInByZXBlbmQiLCJBcnJheSIsImZyb20iLCJmaWx0ZXIiLCJmb3JtIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzaG93SW5wdXRFcnJvciIsImVycm9yTWVzc2FnZSIsInZhbGlkYXRpb25NZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==